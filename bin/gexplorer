#!/usr/bin/env python
from argparse import ArgumentParser
import os

import click
from flask.cli import FlaskGroup

from indexclient.client import IndexClient

import explorer


def parse_args():

    parser = ArgumentParser(description="Graph Explorer script")
    parser.add_argument("-p", "--port",
                        help="HTTP port to listen on", required=False)

    subparser = parser.add_subparsers()

    # starts services
    start = subparser.add_parser("start", help="Start the server")
    start.add_argument("-t", "--threads",
                       help="thread pool size",
                       default=10, type=int)
    start.set_defaults(action="start")
    return parser.parse_args()


def get_index_client():
    return IndexClient(baseurl=os.environ.get("INDEXD_URL", "http://indexd.service.consul/"),
                       auth=(os.environ.get("INDEXD_USER"), os.environ.get("INDEXD_PWD")))


@click.command(cls=FlaskGroup, create_app=explorer.make_app())
def main():
    click.echo("started application")


if __name__ == '__main__':
    main()
